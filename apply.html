<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Подача заявки | ЦНАП</title>
    <style>
        :root {
            --bg: #f8f9fa;
            --white: #ffffff;
            --accent: #0052cc;
            --text: #1a1a1a;
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; color: var(--text); }
        
        header { background: var(--white); padding: 20px 8%; display: flex; justify-content: space-between; border-bottom: 1px solid #eee; }
        
        main { padding: 60px 8%; max-width: 700px; margin: 0 auto; }

        .apply-card {
            background: var(--white);
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.03);
            animation: slideUp 0.6s ease;
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        h1 { font-size: 2rem; letter-spacing: -1px; margin-bottom: 10px; }
        .subtitle { opacity: 0.5; margin-bottom: 30px; }

        .form-group { margin-bottom: 25px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem; }
        
        input, select, textarea {
            width: 100%; padding: 14px; border-radius: 12px;
            border: 1.5px solid #eee; background: #fafafa;
            font-family: inherit; transition: var(--transition); box-sizing: border-box;
        }

        input:focus { border-color: var(--accent); background: white; outline: none; }

        /* Завантаження фото */
        .upload-area {
            border: 2px dashed #ddd; padding: 30px; border-radius: 15px;
            text-align: center; cursor: pointer; transition: var(--transition);
        }
        .upload-area:hover { border-color: var(--accent); background: #f0f4ff; }
        #photo-preview { max-width: 150px; border-radius: 10px; margin-top: 15px; display: none; }

        .btn-submit {
            background: var(--accent); color: white; border: none;
            padding: 18px; border-radius: 14px; font-weight: 700;
            width: 100%; cursor: pointer; transition: var(--transition);
        }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0, 82, 204, 0.2); }
        
        .status-msg {
            display: none; margin-top: 20px; padding: 15px; 
            border-radius: 10px; background: #e7f3ff; color: #0052cc; text-align: center;
        }
    </style>
</head>
<body>

<header>
    <a href="index.html" style="font-weight:800; color:var(--accent); text-decoration:none;">ЦНАП</a>
    <a href="profile.html" style="text-decoration:none; color:var(--text); font-size:0.9rem;">Мій профіль</a>
</header>

<main>
    <div class="apply-card">
        <h1>Оформлення послуги</h1>
        <p class="subtitle">Заповніть форму, і реєстратор опрацює ваш запит.</p>

        <div class="form-group">
            <label>Ваше Ім'я (підтягнуто автоматично)</label>
            <input type="text" id="app-name" readonly>
        </div>

        <div class="form-group">
            <label>Ваш персональний ID</label>
            <input type="text" id="app-id" readonly style="font-family: monospace; color: var(--accent);">
        </div>

        <div class="form-group">
            <label>Тип послуги</label>
            <select id="app-service">
                <option value="ID-картка">Оформлення ID-картки</option>
                <option value="Земельний витяг">Земельна ділянка</option>
                <option value="Техпаспорт">Реєстрація майна</option>
            </select>
        </div>

        <div class="form-group">
            <label>Ваше фото для документа</label>
            <div class="upload-area" onclick="document.getElementById('file-in').click()">
                <span id="upload-text">Натисніть для завантаження</span>
                <input type="file" id="file-in" hidden accept="image/*" onchange="handlePhoto(this)">
                <center><img id="photo-preview" src=""></center>
            </div>
        </div>

        <div class="form-group">
            <label>Додаткові відомості (якщо потрібно)</label>
            <textarea id="app-comment" rows="3" placeholder="Напишіть коментар..."></textarea>
        </div>

        <button class="btn-submit" onclick="submitApplication()">Відправити запит</button>
        <div id="status" class="status-msg">Вашу заявку успішно надіслано! Чекайте на опрацювання.</div>
    </div>
</main>

<script>
    // Завантаження даних з localStorage
    window.onload = () => {
        const urlParams = new URLSearchParams(window.location.search);
        const service = urlParams.get('service');
        
        document.getElementById('app-name').value = localStorage.getItem("userName") || "Громадянин";
        document.getElementById('app-id').value = localStorage.getItem("currentUserID") || "UA-0000";
        
        if(service) document.getElementById('app-service').value = service === 'Земля' ? 'Земельний витяг' : 'ID-картка';
    };

    let photoData = "";
    function handlePhoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                photoData = e.target.result;
                document.getElementById('photo-preview').src = photoData;
                document.getElementById('photo-preview').style.display = "block";
                document.getElementById('upload-text').style.display = "none";
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function submitApplication() {
        const request = {
            id: document.getElementById('app-id').value,
            name: document.getElementById('app-name').value,
            service: document.getElementById('app-service').value,
            photo: photoData,
            comment: document.getElementById('app-comment').value,
            date: new Date().toLocaleString(),
            status: "Очікує"
        };

        // Зберігаємо запит у базу заявок
        let requests = JSON.parse(localStorage.getItem("gov_requests")) || [];
        requests.push(request);
        localStorage.setItem("gov_requests", JSON.stringify(requests));

        // Візуальний ефект
        document.getElementById('status').style.display = "block";
        document.querySelector('.btn-submit').style.display = "none";
        
        setTimeout(() => {
            window.location.href = "index.html";
        }, 3000);
    }
</script>

</body>
</html>
