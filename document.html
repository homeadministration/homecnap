<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–î–æ–∫—É–º–µ–Ω—Ç ‚Äî –¶–ù–ê–ü</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f2f6fb; --card:#ffffff; --accent:#0052cc; --muted:#6b7280; --radius:16px;
}
body{font-family:"Inter",system-ui,Arial;margin:0;background:linear-gradient(180deg,#eef6ff 0%,#f8fbff 100%);color:#0f172a}
header{position:sticky;top:0;background:rgba(255,255,255,0.7);backdrop-filter:blur(6px);padding:14px 6%;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(15,23,42,0.06)}
.back{color:var(--accent);font-weight:700;text-decoration:none}
.container{max-width:980px;margin:28px auto;padding:26px;background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.92));border-radius:16px;box-shadow:0 18px 40px rgba(2,6,23,0.06);border:1px solid rgba(2,6,23,0.04)}
.title{font-weight:800;font-size:1.5rem;margin-bottom:8px}
.meta{color:var(--muted);margin-bottom:18px}
.content{white-space:pre-wrap;line-height:1.6;font-size:1rem;margin-bottom:18px}
.img{max-width:100%;border-radius:12px;margin-bottom:14px;border:1px solid rgba(2,6,23,0.04)}
.sign{max-height:140px;border-radius:10px;border:1px solid rgba(2,6,23,0.04);display:block;margin-top:10px}
.controls{display:flex;gap:12px;margin-top:18px;align-items:center}
.btn{background:var(--accent);color:white;padding:12px 16px;border-radius:12px;border:0;cursor:pointer;font-weight:700}
.btn-danger{background:#ef4444}
.stamps{display:flex;gap:20px;flex-wrap:wrap;margin-top:20px;align-items:center}

/* --- stamp CSS (your provided designs) --- */
.stamp{width:140px;height:140px;position:relative;display:flex;align-items:center;justify-content:center;transform:rotate(-10deg);font-family:'Times New Roman',serif;user-select:none}
.stamp-grain{position:absolute;inset:0;border-radius:50%;background-image:url('https://www.transparenttextures.com/patterns/stardust.png');opacity:0.28;pointer-events:none;z-index:2}
.stamp-circle{width:130px;height:130px;border:3px solid rgba(0,82,204,0.8);border-radius:50%;position:relative;display:flex;align-items:center;justify-content:center}
.stamp-circle::after{content:'';position:absolute;width:90px;height:90px;border:1.5px solid rgba(0,82,204,0.6);border-radius:50%}
.stamp-content{text-align:center;color:rgba(0,82,204,0.8);z-index:1}
.stamp-logo{font-size:24px;display:block;margin-bottom:2px}
.stamp-text{font-size:8px;font-weight:900;letter-spacing:0.5px;display:block}
.stamp-date{font-size:11px;font-weight:bold;margin-top:4px;display:inline-block;border-top:1px solid rgba(0,82,204,0.6)}
.stamp-svg{position:absolute;width:100%;height:100%;pointer-events:none}

.square-stamp{width:160px;height:90px;position:relative;display:flex;align-items:center;justify-content:center;transform:rotate(-2deg);font-family:Arial, sans-serif;user-select:none}
.stamp-texture{position:absolute;inset:0;background-image:url('https://www.transparenttextures.com/patterns/stardust.png');opacity:0.28;z-index:2;pointer-events:none}
.stamp-border{width:100%;height:100%;border:3px solid rgba(0,82,204,0.8);padding:4px;display:flex;align-items:center;justify-content:center}
.stamp-inner-border{width:100%;height:100%;border:1px solid rgba(0,82,204,0.6);display:flex;flex-direction:column;justify-content:space-around;align-items:center;padding:5px;color:rgba(0,82,204,0.8)}
.stamp-header{font-size:9px;font-weight:800;text-transform:uppercase;letter-spacing:1px;border-bottom:1px solid rgba(0,82,204,0.4);width:100%;text-align:center;padding-bottom:3px}
.stamp-main{font-size:14px;font-weight:900;text-transform:uppercase}
.stamp-footer{width:100%;display:flex;justify-content:space-between;font-size:10px;font-weight:bold;border-top:1px solid rgba(0,82,204,0.4);padding-top:3px}
.id-number{font-family:monospace;font-size:9px}
</style>
</head>
<body>

<header>
  <a class="back" href="profile.html">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</a>
  <div style="font-weight:800;color:var(--accent)">–¶–ù–ê–ü.–£–ö–†</div>
</header>

<div class="container">
  <div class="container" id="wrap">
    <div class="title" id="title">–ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –¥–æ–∫—É–º–µ–Ω—Ç...</div>
    <div class="meta" id="meta"></div>

    <div class="content" id="content">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>

    <div id="images"></div>

    <div>
      <div style="font-weight:700;margin-top:10px">–ü—ñ–¥–ø–∏—Å —Ä–µ—î—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div>
      <img id="signature" class="sign" src="" alt="–ø—ñ–¥–ø–∏—Å" style="display:none">
    </div>

    <div class="stamps" id="stamps">
      <!-- stamps injected here -->
    </div>

    <div class="controls">
      <button class="btn btn-danger" id="requestDelete">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–ø–∏—Ç –Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è</button>
      <div class="small" style="color:#6b7280">–ó–∞–ø–∏—Ç –ø–æ—Ç—Ä–∞–ø–∏—Ç—å —É –∞–¥–º—ñ–Ω–∫—É (–ó–∞–ø–∏—Ç–∏ –Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è)</div>
    </div>
  </div>
</div>

<script>
/* get uid + docId */
const params = new URLSearchParams(location.search);
const uid = params.get('uid');
const docId = params.get('docId');

const DB_KEY = 'gov_documents';
const DELETE_KEY = 'delete_requests';

const db = JSON.parse(localStorage.getItem(DB_KEY)) || {};
let doc = null;
if(uid && docId && db[uid]){
  doc = db[uid].find(d => d.docId === docId);
}

/* if document missing -> show message */
const titleEl = document.getElementById('title');
const metaEl = document.getElementById('meta');
const contentEl = document.getElementById('content');
const imagesEl = document.getElementById('images');
const signatureEl = document.getElementById('signature');
const stampsEl = document.getElementById('stamps');

function formatDateOrDash(d){ return d ? new Date(d).toLocaleDateString('uk-UA') : '‚Äî'; }

if(!doc){
  titleEl.innerText = '–î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
  metaEl.innerText = '';
  contentEl.innerText = '–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ –≤—ñ–¥–∫—Ä–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç (uid + docId).';
} else {
  titleEl.innerText = doc.type || '–î–æ–∫—É–º–µ–Ω—Ç';
  const validUntil = doc.validUntil ? new Date(doc.validUntil) : null;
  const now = new Date(); now.setHours(0,0,0,0);
  const isValid = validUntil ? (validUntil >= now) : false;
  metaEl.innerHTML = `ID: <b>${uid}</b> &nbsp;&nbsp; | &nbsp;&nbsp; –í—ñ–¥: <b>${doc.source || '–¶–ù–ê–ü'}</b> &nbsp;&nbsp; | &nbsp;&nbsp; –î—ñ–π—Å–Ω–∏–π –¥–æ: <b>${formatDateOrDash(doc.validUntil)}</b>`;

  contentEl.innerText = doc.desc || '(–Ω–µ–º–∞—î –æ–ø–∏—Å—É)';

  // images
  imagesEl.innerHTML = '';
  if(doc.img){
    const img = document.createElement('img'); img.src = doc.img; img.className='img'; imagesEl.appendChild(img);
  }

  // signature
  if(doc.signature){
    signatureEl.src = doc.signature; signatureEl.style.display='block';
  }

  // stamp date logic: if doc.stampDate exists use it, else use today (but do not modify doc)
  const stampDate = doc.stampDate ? new Date(doc.stampDate) : new Date();

  // render only the chosen stamp
  stampsEl.innerHTML = '';
  const stampType = doc.stampType || 'circle';

  if(stampType === 'circle'){
    const div = document.createElement('div');
    div.className = 'stamp';
    div.innerHTML = `
      <div class="stamp-grain"></div>
      <div class="stamp-circle">
        <svg class="stamp-svg" viewBox="0 0 140 140">
          <path id="curve-${docId}" d="M 70, 70 m -55, 0 a 55,55 0 1,1 110,0 a 55,55 0 1,1 -110,0" fill="none" />
          <text fill="rgba(0, 82, 204, 0.8)" font-size="9.5" font-weight="bold" letter-spacing="1.8">
            <textPath href="#curve-${docId}">
              ‚Ä¢ –¶–ù–ê–ü –û–ù–õ–ê–ô–ù ‚Ä¢ –î–ï–†–ñ–ê–í–ù–ê –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¶–Ü–Ø ‚Ä¢
            </textPath>
          </text>
        </svg>
        <div class="stamp-content">
          <span class="stamp-logo">üî±</span>
          <span class="stamp-text">–ó–ê–¢–í–ï–†–î–ñ–ï–ù–û</span>
          <span class="stamp-date">${stampDate.toLocaleDateString('uk-UA')}</span>
        </div>
      </div>
    `;
    stampsEl.appendChild(div);
  } else if(stampType === 'square'){
    const div = document.createElement('div');
    div.className = 'square-stamp';
    div.innerHTML = `
      <div class="stamp-texture"></div>
      <div class="stamp-border">
        <div class="stamp-inner-border">
          <div class="stamp-header">–£–∫—Ä–∞—ó–Ω–∞ ‚Ä¢ –¶–ù–ê–ü –û–Ω–ª–∞–π–Ω</div>
          <div class="stamp-main">–û–ü–†–ê–¶–¨–û–í–ê–ù–û</div>
          <div class="stamp-footer">
            <span>${stampDate.toLocaleDateString('uk-UA')}</span>
            <span class="id-number">${docId}</span>
          </div>
        </div>
      </div>
    `;
    stampsEl.appendChild(div);
  } // else none
}

// delete request handler (push to delete_requests key)
document.getElementById('requestDelete').addEventListener('click', () => {
  if(!doc){ alert('–î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'); return; }
  const arr = JSON.parse(localStorage.getItem(DELETE_KEY)) || [];
  // prevent multiple identical requests from same user/doc
  const exists = arr.find(r => r.uid === uid && r.docId === docId);
  if(exists) { alert('–ó–∞–ø–∏—Ç –Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤–∂–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ'); return; }
  arr.push({ uid, docId, type: doc.type||'–Ω–µ–≤—ñ–¥–æ–º–æ', date: new Date().toLocaleString() });
  localStorage.setItem(DELETE_KEY, JSON.stringify(arr));
  alert('–ó–∞–ø–∏—Ç –Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É');
});
</script>
</body>
  </html>
