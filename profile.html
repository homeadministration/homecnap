<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Мої документи | ЦНАП</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<style>
:root{
--bg:#f8f9fa; --white:#fff; --accent:#0052cc; --text:#1a1a1a; --border:rgba(0,0,0,0.08); --radius:16px; --transition:all 0.3s ease;
}
body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);}
header{background:var(--white);padding:20px 8%;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,0.05);}
header a.logo{font-weight:800;font-size:1.3rem;color:var(--accent);text-decoration:none;}
main{padding:30px 8%;}
h1{margin-bottom:20px;}
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;}
.card{background:var(--white);padding:20px;border-radius:var(--radius);box-shadow:0 4px 15px rgba(0,0,0,0.05);border:1px solid var(--border);}
.card img{max-width:100%;border-radius:12px;margin-bottom:10px;}
.card h3{margin:0 0 5px 0;font-size:1.1rem;color:var(--accent);}
.card p{margin:0 0 5px 0;font-size:0.9rem;opacity:0.7;}
.card .expiry{font-size:0.8rem;opacity:0.6;margin-top:5px;}
</style>
</head>
<body>

<header>
    <a href="index.html" class="logo">ЦНАП.УКР</a>
    <nav>
        <a href="index.html">Головна</a>
        <a href="profile.html" style="font-weight:700;">Мої документи</a>
        <a href="admin.html" id="nav-admin" style="display:none;">Адмін</a>
    </nav>
</header>

<main>
    <h1>Мої документи</h1>
    <div class="cards" id="docs-container">
        <!-- Документи з Firebase з’являться тут -->
    </div>
</main>

<script>
// Перевірка ролі для відображення адмін-посилання
if(localStorage.getItem("userRole")==="highadmin"){
    document.getElementById("nav-admin").style.display="inline-block";
}

// Firebase
const firebaseConfig={
apiKey:"AIzaSyCApR43px9v7aSh-84HiF_xAo-Me7j46e4",
authDomain:"cnapminecraft.firebaseapp.com",
databaseURL:"https://cnapminecraft-default-rtdb.firebaseio.com",
projectId:"cnapminecraft",
storageBucket:"cnapminecraft.appspot.com",
messagingSenderId:"935970032676",
appId:"1:935970032676:web:49014e14b8adedfe99dcb1",
measurementId:"G-5JMCJR0X61"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// Отримуємо ID користувача
const userID=localStorage.getItem("currentUserID");
if(!userID){
    alert("ID користувача не знайдено!");
    window.location.href="index.html";
}

// Функція для створення картки документа
function createDocCard(doc){
    const container=document.getElementById("docs-container");
    const div=document.createElement("div");
    div.className="card";

    let html=`<h3>${doc.type}</h3>`;
    if(doc.img) html+=`<img src="${doc.img}" alt="Фото документа">`;
    if(doc.desc) html+=`<p>${doc.desc}</p>`;
    if(doc.signature) html+=`<p>Підпис реєстратора:</p><img src="${doc.signature}" style="max-width:100px;border:1px solid #eee;border-radius:6px;">`;
    if(doc.validUntil) html+=`<p class="expiry">Дійсний до: ${doc.validUntil}</p>`;
    html+=`<p class="expiry">Видано: ${new Date(doc.issuedAt).toLocaleDateString()}</p>`;
    div.innerHTML=html;
    container.appendChild(div);
}

// Підписка на зміни документів
db.ref('citizens/'+userID+'/documents').on('child_added', snapshot=>{
    const doc=snapshot.val();
    createDocCard(doc);
});
</script>

</body>
</html>
